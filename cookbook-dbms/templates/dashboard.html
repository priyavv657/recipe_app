<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cookbook Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>🍲 Welcome to the Cookbook Dashboard</h1>
        <p>Welcome, {{ session['username'] }}! <a href="/logout">Logout</a></p>

        <!-- Search Bar -->
        <form method="get" action="/dashboard">
            <input type="text" name="search" placeholder="Search recipes..." value="{{ search }}">
            <button type="submit">Search</button>
            {% if not show_saved %}
            <a href="{{ url_for('view_saved') }}" class="save-btn">💾 View Saved Recipes</a>
            {% else %}
            <a href="{{ url_for('dashboard') }}" class="save-btn">🔍 Back to All Recipes</a>
            {% endif %}
        </form>

        <!-- Recipe Submission Form -->
        <form action="{{ url_for('add_recipe') }}" method="post" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Recipe Title" required><br>
            <input type="text" name="author" placeholder="Author Name" required><br>
            <input type="file" name="image_file" accept="image/*"><br>
            <textarea name="content" placeholder="Recipe Instructions" rows="5" required></textarea><br>
            <button type="submit">Add Recipe</button>
        </form>

        <hr>

        <h2>{{ search if search else "🍽️ All Recipes" }}</h2>

        <!-- Recipe List -->
        {% for recipe in recipes %}
        <div class="recipe">
            <a href="{{ url_for('view_recipe', recipe_id=recipe['id']) }}">
                <h3>{{ recipe.title }} (ID: {{ recipe['id'] }})</h3>
            </a>
            <p><strong>By:</strong> {{ recipe.author }}</p>
            {% if recipe.image %}
                <img src="{{ recipe.image }}" alt="Recipe Image" class="recipe-img">
            {% endif %}
            <p>{{ recipe.instructions }}</p>
            
            {% if not show_saved %}
            <a href="{{ url_for('save_recipe', recipe_id=recipe['id']) }}" class="save-btn">💾 Save Recipe</a>
            {% endif %}

            <!-- Delete Button: Only show if current user is the author -->
            {% if recipe.author == session['username'] %}
            <form action="{{ url_for('delete_recipe', recipe_id=recipe['id']) }}" method="post" style="display:inline;">
                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this recipe?')">🗑️ Delete</button>
            </form>
            {% endif %}
        </div>
        {% else %}
        <p>No recipes found.</p>
        {% endfor %}
    </div>
</body>
</html>
